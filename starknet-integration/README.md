# WiFiProof - Starknet Integration

Zero-knowledge proof system for privacy-preserving venue attendance verification on Starknet.

## Live Demo

**Watch the complete demo video**: [WiFiProof Starknet Demo on Vimeo](https://vimeo.com/1127201456)

This walkthrough demonstrates:
- Portal nonce fetching and cryptographic signing
- Witness generation in browser using NoirJS
- ZK proof generation with Ultra Honk (Starknet flavor)
- Cairo verifier generation using Garaga
- On-chain proof verification on Starknet devnet
- Complete end-to-end flow from WiFi portal to blockchain

**Note on Browser Proving**: While witness generation works perfectly in the browser, full proof generation currently uses CLI due to WebAssembly SharedArrayBuffer optimization in progress. The CLI proof generation works flawlessly (~5 seconds per proof). This doesn't affect the core ZK system - all cryptographic operations, circuit compilation, and on-chain verification are fully functional.

## What is This?

WiFiProof allows users to prove they attended a venue (connected to its WiFi captive portal) **without revealing**:
- Which specific WiFi network thesy connected to
- Their personal device information
- Their user secret

The proof is verified on-chain on Starknet, providing cryptographic certainty of attendance while preserving privacy.

##  Architecture

```
┌─────────────┐         ┌──────────────┐         ┌─────────────┐
│   Venue     │  nonce  │    User      │  proof  │  Starknet   │
│   Portal    ├────────>│   Browser    ├────────>│  Verifier   │
│  (WiFi AP)  │         │  (Noir+ZK)   │         │  Contract   │
└─────────────┘         └──────────────┘         └─────────────┘
```

##  Project Structure

```
starknet-integration/
├── circuit/              # Noir ZK circuit
│   └── src/main.nr      # WiFiProof circuit implementation
├── contracts/           # Cairo verifier contract
│   └── verifier/        # Generated by Garaga
├── app/                 # React web interface
│   ├── src/
│   │   ├── App.tsx      # Main application logic
│   │   └── assets/      # Circuit artifacts
│   └── vite.config.ts
├── garaga-venv/         # Python environment for Garaga
├── Makefile             # Build automation
├── DEMO_SCRIPT.md       # Complete demo walkthrough
└── README.md            # This file
```

## 🚀 Quick Start

### Prerequisites

Install the required tools:

```bash
# Install Noir
curl -L https://raw.githubusercontent.com/noir-lang/noirup/main/install | bash
noirup --version 1.0.0-beta.5

# Install Barretenberg
curl -L https://raw.githubusercontent.com/AztecProtocol/aztec-packages/master/barretenberg/bbup/install | bash
bbup --version 0.87.4-starknet.1

# Install Starknet tooling
curl --proto '=https' --tlsv1.2 -sSf https://sh.starkup.dev | sh

# Install Starknet Devnet via asdf
asdf plugin add starknet-devnet
asdf install starknet-devnet 0.4.3

# Install Bun (for web app)
curl -fsSL https://bun.sh/install | bash

# Create Python virtual environment and install Garaga
python3 -m venv garaga-venv
source garaga-venv/bin/activate
pip install garaga==0.18.1
```

### Setup

```bash
# Clone the repo and navigate here
cd starknet-integration

# Install app dependencies
cd app && bun install && cd ..

# Activate Python environment (needed for Garaga commands)
source garaga-venv/bin/activate
```

## 🎬 Complete Workflow

### Step 1: Start Portal Server

The portal server simulates a captive WiFi portal:

```bash
# In terminal 1
cd ../portal-server
node server.js
```

Portal runs on http://localhost:3002

### Step 2: Build Circuit

```bash
# Build the Noir circuit
make build-circuit

# Execute with sample inputs (generates witness)
make exec-circuit
```

**Output:**
- `circuit/target/circuit.json` - Compiled circuit
- `circuit/target/witness.gz` - Execution witness

### Step 3: Generate Proof

```bash
# Generate ZK proof using Ultra Honk
make prove-circuit

# Generate verification key
make gen-vk
```

**Output:**
- `circuit/target/proof` - ZK proof (~14KB)
- `circuit/target/vk` - Verification key
- `circuit/target/public_inputs` - Public circuit inputs

### Step 4: Generate Cairo Verifier

```bash
# Use Garaga to convert verifier to Cairo
make gen-verifier

# Build the Cairo contract
make build-verifier
```

**Output:**
- `contracts/verifier/src/honk_verifier.cairo` - Cairo verifier contract
- `contracts/verifier/target/release/` - Compiled contract

### Step 5: Deploy to Starknet Devnet

```bash
# In terminal 2 - Start devnet
make devnet
```

Devnet runs on http://localhost:5050

```bash
# In terminal 3 - Deploy verifier
source garaga-venv/bin/activate

# Declare the contract
make declare-verifier
# Save the Class Hash from output

# Deploy the contract
make deploy-verifier
# Save the Contract Address from output
```

### Step 6: Verify Proof On-Chain 

```bash
# Generate calldata from proof
make gen-calldata

# Verify the proof on Starknet!
./verify_proof.sh
```

**Expected Output:**
```
Generating calldata...
Calldata generated. Length: 2864 felts

Calling verifier contract...
Success: Call completed

Response: [0x0, 0x7, 0x10932, ...]
```

 **Success!** Your proof has been verified on-chain!

### Step 7: Run Web Application

```bash
# Copy circuit artifacts to app
make artifacts

# Start dev server
make run-app
```

Navigate to http://localhost:5173

**Working Features:**
- ✅ Portal nonce fetching
- ✅ Witness generation
-  Proof generation (optimization in progress - use CLI for now)

##  Makefile Commands

### Circuit Commands
- `make build-circuit` - Compile Noir circuit
- `make exec-circuit` - Execute circuit with test inputs
- `make prove-circuit` - Generate ZK proof
- `make gen-vk` - Generate verification key

### Verifier Commands
- `make gen-verifier` - Generate Cairo verifier with Garaga
- `make build-verifier` - Compile Cairo contract

### Deployment Commands
- `make devnet` - Start Starknet devnet
- `make declare-verifier` - Declare contract to devnet
- `make deploy-verifier` - Deploy contract to devnet

### Proof Verification
- `make gen-calldata` - Generate calldata from proof
- `./verify_proof.sh` - Verify proof on-chain (all-in-one script)

### Application Commands
- `make artifacts` - Copy circuit artifacts to app
- `make run-app` - Start web app dev server

### Installation Commands
- `make install-noir` - Install Noir compiler
- `make install-barretenberg` - Install Barretenberg prover
- `make install-starknet` - Install Starknet tooling
- `make install-devnet` - Install Starknet devnet
- `make install-garaga` - Install Garaga (needs Python venv)
- `make install-app-deps` - Install app dependencies

##  Testing

### Test the Full Flow

```bash
# Run all steps sequentially
make build-circuit
make exec-circuit
make prove-circuit
make gen-vk
make gen-verifier

# In separate terminal: make devnet

make declare-verifier
make deploy-verifier
./verify_proof.sh
```

If you see `Success: Call completed`, your proof was verified on Starknet! 🎉

### Verify Circuit Logic

The circuit in `circuit/src/main.nr` verifies:
1. User secret matches the commitment
2. Venue ID and Event ID match
3. Nonce hash is correct
4. Portal signature hash is valid
5. Proof timestamp is within valid time window

##  Configuration Files

### snfoundry.toml

Contains Starknet network configuration:

```toml
[sncast.default]
url = "http://localhost:5050/rpc"
accounts-file = "accounts.json"
account = "devnet0"
```

### accounts.json

Contains devnet account details. Generated automatically when devnet starts.

### Prover.toml

Contains test inputs for the circuit. Used by `make exec-circuit`.

##  Privacy Features

**What's Private:**
- User secret (never leaves user's device)
- Specific WiFi MAC address
- Connection details

**What's Public (in proof):**
- Venue ID (e.g., "VENUE_67890")
- Event ID (e.g., "EVENT_20250921")
- Timestamp range
- Proof that user has valid secret

##  Use Cases

1. **Event Attendance**: Prove you attended a conference without revealing which sessions
2. **Loyalty Programs**: Accumulate venue check-ins privately
3. **Access Control**: Prove eligibility without revealing identity
4. **Location-based Rewards**: Claim rewards for visiting venues while preserving privacy

##  Troubleshooting

### Proof Generation Hangs in Browser

**Status**: Known issue - optimization in progress

**Workaround**: Use command-line proof generation:
```bash
make prove-circuit
```

The CLI proof generation takes ~5 seconds and works perfectly.

### sncast Can't Find Account

Make sure:
1. Devnet is running
2. `accounts.json` exists in `contracts/` directory
3. Running commands from the right directory with `--profile devnet`

### Garaga Command Not Found

Activate the Python virtual environment:
```bash
source garaga-venv/bin/activate
```

### Devnet Connection Refused

Make sure devnet is running:
```bash
make devnet
```

Should show: `Starknet Devnet listening on 127.0.0.1:5050`

## 🗺️ Roadmap

### Current Status (MVP)
- ✅ Complete Noir circuit implementation
- ✅ Command-line proof generation (Ultra Honk)
- ✅ Cairo verifier generation (Garaga)
- ✅ Deployment to Starknet devnet
- ✅ On-chain proof verification
- ✅ Portal integration
- ✅ Browser witness generation

### In Progress
- Browser-based proof generation optimization
-  Wallet integration (Argent, Braavos)

### Planned
- [ ] Deploy to Starknet Sepolia testnet
- [ ] Multiple venue support
- [ ] Proof aggregation for multiple check-ins
- [ ] Venue operator dashboard
- [ ] Mainnet deployment
- [ ] Integration with real captive portal systems

##  Technical Stack

- **ZK Circuit**: Noir 1.0.0-beta.5
- **Proving System**: Barretenberg Ultra Honk (Starknet flavor)
- **Verifier Generator**: Garaga 0.18.1
- **Smart Contract**: Cairo 2.x
- **Blockchain**: Starknet (devnet 0.4.3)
- **Frontend**: React + TypeScript + Vite
- **Deployment**: Starknet Foundry (sncast)